MethodOverride is another function which is used when in case of html forms only get and psot requests can be sent to your 
backend thus this is used in case when you have to send patch and delete request.

MongoDb saves the Data in the form of Bson Data not Json Data.

import express from "express";
import cors from "cors";
import cookieParser from "cookie-parser";
import morgan from "morgan";
import mongoose,{Schema} from "mongoose";


const app=express();
morgan(function (tokens,req,res){
   return [
    tokens.method(req, res),
    tokens.url(req, res),
    tokens.status(req, res),
    tokens.res(req, res, 'content-length'), '-',
    tokens['response-time'](req, res), 'ms'
    ].join(' ')
});
app.use("/api",(req,res,next)=>{
    const {token}=req.query;
    if(token=="giveAccess"){
        next();
    }
    else{
        res.send("Access Denied");
    }
})

app.use(morgan('combined'));
app.use(cors({
    origin:process.env.CORS_ORIGIN,
    credentials:true
}));
app.use(express.json({limit:"16kb"}));
app.use(express.urlencoded({extended:true,limit:"16kb"}));
// 
app.use(express.static("public"));  // jab bhi koi file aayi yah folder aaya and hum usse apne hee folder mai store rkhna chahte hai 
app.use(cookieParser());
// then it is for that purpose.
// File aa rhi hai image aa rhi hai form sa kuch data aa rha hai 
// Returns middleware that only parses json and only looks at requests where the Content-Type header matches the type option.

// Middleware are used before sending anything to the client in order to validate the user and at the times to support authentication. 
export default app;

// Data will be coming in the form of JSON // like postman request 
// Data will be coming in the form of req.body from others

    const avatarlocalpath=req.files?.avatar?.[0]?.path;
    const coverImageLocalPath=req.files?.coverImage?.[0]?.path;
    const coverImage=coverImageLocalPath ? await uploadoncloudinary(coverImageLocalPath) : null;


app.post("/signin",(req,res)=>{
    const {username,password}=req.body;
    const userFound=users.find((u)=>u.username==username && u.password==password);

    if(userFound){
        const token=jwt.sign({
            username:userFound
        },JWT_SECRET);
        res.json({
            token:token
        });
    }
    else{
        res.status(404).send("Incorrect Credentials");
    }
});
app.get("/me",(req,res)=>{
    const token=req.headers.authorization;

    const decodedInfo=jwt.verify(token,JWT_SECRET);
    // jwt.decode (token)  // It imposes security vulnerability.
    const username=decodedInfo.username;
    const user=users.find((u)=>u.username==username);
    if(user){
        res.json({
            username:user.username,
            password:user.password
        })
    }else{
        res.json({
            username:user.username,
            password:user.password
        })     
    }
    // verifying the token.
    // If you end up decoding toh unka bhi token validhojayga toh make sure you ae 

})

app.post("/signup",(req,res)=>{
    const {username,password}=req.body;
    users.push({username,password});
    res.json({msg:"User is signed up"});
})